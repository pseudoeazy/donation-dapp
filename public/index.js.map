{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/client/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { Web3 } from 'web3';\r\nimport detectEthereumProvider from '@metamask/detect-provider';\r\n\r\ndeclare global {\r\n  interface Window {\r\n    ethereum?: any;\r\n    web3?: Web3;\r\n    ownerAddress?: string;\r\n  }\r\n}\r\n\r\nconst view = {\r\n  connectEl: document.getElementById('connect') as HTMLInputElement,\r\n  senderEl: document.getElementById('sender') as HTMLInputElement,\r\n  recipientEl: document.getElementById('recipient') as HTMLInputElement,\r\n  amountEl: document.getElementById('amount') as HTMLInputElement,\r\n  donateEl: document.getElementById('donate') as HTMLButtonElement,\r\n  donationRaisedEl: document.getElementById(\r\n    'donationRaised'\r\n  ) as HTMLSpanElement,\r\n  withdrawEl: document.getElementById('withdraw') as HTMLButtonElement,\r\n  balanceEl: document.getElementById('balance') as HTMLButtonElement,\r\n};\r\n\r\nfunction toggleDisabled(isEnabled: boolean) {\r\n  view.senderEl.disabled =\r\n    view.recipientEl.disabled =\r\n    view.amountEl.disabled =\r\n    view.donateEl.disabled =\r\n      isEnabled;\r\n}\r\n\r\nfunction getContractAddress() {\r\n  return '0x6d212029F6F378bFC75582546888BF3145ED57F1';\r\n}\r\n\r\nasync function connectToMetaMask(): Promise<void> {\r\n  const provider = await detectEthereumProvider();\r\n\r\n  if (provider) {\r\n    if (window.ethereum) {\r\n      try {\r\n        window.web3 = new Web3(window.ethereum);\r\n        console.log('Connected to MetaMask');\r\n      } catch (error) {\r\n        alert(error.message);\r\n        console.error('User denied account access', error);\r\n      }\r\n    } else {\r\n      // Set the provider you want from Web3.providers\r\n      // web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:7545'));\r\n      console.error(\r\n        'Non-MetaMask browser detected. You should consider trying MetaMask!'\r\n      );\r\n      alert(\r\n        'Non-MetaMask browser detected. You should consider trying MetaMask!'\r\n      );\r\n    }\r\n  } else {\r\n    // Non-dapp browsers\r\n    console.error('No Ethereum provider detected. Install MetaMask.');\r\n    alert('No Ethereum provider detected. Install MetaMask.');\r\n  }\r\n}\r\n\r\nasync function requestAccountAccess(): Promise<string | undefined> {\r\n  const accounts = await window.ethereum.request({\r\n    method: 'eth_requestAccounts',\r\n  });\r\n  const account = accounts[0];\r\n\r\n  if (account) {\r\n    await getOwnerAddress();\r\n    view.senderEl.value = account;\r\n    view.connectEl.classList.add('hide');\r\n    toggleDisabled(false);\r\n\r\n    return account;\r\n  } else {\r\n    alert('Account Not Found!');\r\n  }\r\n}\r\n\r\nasync function fetchAbiFile(): Promise<\r\n  { abi: any; address: string } | undefined\r\n> {\r\n  try {\r\n    const abiFilePath = '/build/contracts/Donation.json';\r\n    const response = await fetch(abiFilePath);\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n    const contractAbi = await response.json();\r\n    const contractAbiNetworks = contractAbi.networks;\r\n    console.log({\r\n      contractAbi,\r\n    });\r\n    return {\r\n      abi: contractAbi.abi,\r\n      address: contractAbiNetworks['5777']['address'],\r\n    };\r\n  } catch (error) {\r\n    console.error('Error fetching the file:', error);\r\n  }\r\n}\r\n\r\nasync function getContract(web3: Web3) {\r\n  const contractAbiFile = await fetchAbiFile();\r\n  const contractInstance = new web3.eth.Contract(\r\n    contractAbiFile.abi,\r\n    contractAbiFile.address\r\n  );\r\n  return contractInstance;\r\n}\r\n\r\nasync function donateEther() {\r\n  const web3 = new Web3(window.ethereum);\r\n  const donationContract = await getContract(web3);\r\n  const accounts = await web3.eth.getAccounts();\r\n  const fromAddress = accounts[0];\r\n  const amount = view.amountEl.value;\r\n  console.log({ fromAddress, amount });\r\n\r\n  toggleDisabled(true);\r\n  await donationContract.methods.donate().send({\r\n    from: fromAddress,\r\n    value: web3.utils.toWei(amount, 'ether'),\r\n  });\r\n\r\n  toggleDisabled(false);\r\n}\r\n\r\n// check contract balance\r\nasync function checkContractBalance() {\r\n  const web3 = new Web3(window.ethereum);\r\n  const donationContract = await getContract(web3);\r\n  const balance = await donationContract.methods.contractBalance().call();\r\n  console.log('Contract Balance:', balance, 'ETH');\r\n}\r\n\r\n// withdraw funds (only the owner can do this)\r\nasync function withdraw() {\r\n  const web3 = new Web3(window.ethereum);\r\n  const donationContract = await getContract(web3);\r\n  const ownerAddress = await getOwnerAddress();\r\n  const amount = view.amountEl.value;\r\n\r\n  await donationContract.methods\r\n    .withdraw(web3.utils.toWei(amount, 'ether'))\r\n    .send({\r\n      from: ownerAddress,\r\n    });\r\n\r\n  console.log('Withdrawal successful!');\r\n}\r\n\r\nasync function listenForContractEvents() {\r\n  const web3 = new Web3(window.ethereum);\r\n  const donationContract = await getContract(web3);\r\n\r\n  donationContract.events.DonationReceived().on('data', (event) => {\r\n    console.log('Donation Received:', event.returnValues);\r\n  });\r\n\r\n  donationContract.events.DonationReceived().on('error', function (error) {\r\n    console.error(error);\r\n  });\r\n}\r\n\r\nasync function getOwnerAddress(): Promise<string> {\r\n  try {\r\n    const web3 = new Web3(window.ethereum);\r\n    const donationContract = await getContract(web3);\r\n    const ownerAddress: string =\r\n      window.ownerAddress || (await donationContract.methods.owner().call());\r\n    view.recipientEl.value = ownerAddress;\r\n    window.ownerAddress = ownerAddress;\r\n\r\n    console.log(`Owner Address: ${ownerAddress}`);\r\n    return ownerAddress;\r\n  } catch (error) {\r\n    console.error('Error fetching owner address:', error);\r\n  }\r\n}\r\n\r\nlistenForContractEvents();\r\nwindow.addEventListener('load', connectToMetaMask);\r\nview.connectEl.addEventListener('click', requestAccountAccess);\r\nview.donateEl.addEventListener('click', donateEther);\r\nview.withdrawEl.addEventListener('click', withdraw);\r\nview.balanceEl.addEventListener('click', checkContractBalance);\r\n"]}